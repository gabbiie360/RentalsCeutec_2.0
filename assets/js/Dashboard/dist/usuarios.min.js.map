{"version":3,"sources":["usuarios.js"],"names":["_firebaseConfig","require","_firebaseFirestore","_toast","usuariosRef","collection","db","cargarUsuarios","tabla","document","getElementById","innerHTML","filtroCorreo","value","toLowerCase","filtroRol","onSnapshot","snapshot","forEach","docu","data","uid","email","trim","includes","rol","createElement","fila","concat","coincideRol","appendChild","nuevoRol","select","dataset","regeneratorRuntime","async","_context","prev","next","this","awrap","mostrarToast","t0","stop","eliminarUsuario","_context2","confirm","deleteDoc","doc"],"mappings":"kJAAA,IAAAA,gBAAAC,QAAA,gCACAC,mBAAAD,QAAA,mEACAE,OAAAF,QAAA,uBAEMG,aAAc,EAAAF,mBAAAG,YAAWC,gBAAAA,GAAI,YAE5B,SAASC,iBACd,IAAMC,EAAQC,SAASC,eAAe,iBAPxCF,EAAAG,UAAA,GACA,IAAAC,EAAAH,SAAAC,eAAA,uBAAAG,MAAAC,cAUQC,EAAYN,SAASC,eAAe,aAAaG,OAEvD,EAAAX,mBAAAc,YAAWZ,YAAa,SAACa,GATrBb,EAAAA,UAAc,GAWhBa,EAASC,QAAQ,SAACC,GATf,IAASZ,EAAAA,EAATa,OACMC,EAAGZ,EAASC,GACjBC,EAAYS,EAAlBE,OAAA,GAEMV,EAAYQ,EAAGX,KAASC,OACxBK,GAAAA,EAASQ,SAGbD,EAAAR,cAAAU,SAAAZ,MACiBG,GAAUU,IAAAV,IAEzB,CACA,IAAMO,EAAQF,SAAAM,cAAd,MACAC,EAAShB,UAAT,mBAAAiB,OACUN,EADV,4FAAAM,OAIAP,EAJA,2CAAAO,OAYuC,SAARH,EAAiB,WAAa,GAZ7D,2DAAAG,OAMmC,UAAbC,EAAa,WAAA,GANnC,kKAAAD,OAuBCP,EAvBD,sGA2BkCb,EAAAsB,YAAAH,MAC1BI,SAAAA,iBAAW,oBADeb,QAAA,SAAAc,GAE1BX,EAAAA,iBAAWY,SAFe,WAAA,IAAAF,EAAAV,EAAA,OAAAa,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAP,EAAAQ,KAAA1B,MAAAQ,EAAAkB,KAAAN,QAAAZ,IAAAe,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAAAJ,mBAAAM,OAIcf,EAAAA,mBAAAA,YAAKM,EAAAA,mBAAAA,KAAAA,gBAAAA,GAAAA,WAAAA,GAAAA,CAAAA,IAAAA,KAJnB,KAAA,GAIY,EAAA5B,OAAAsC,cAJZ,iCAAA,WAAAL,EAAAE,KAAA,GAAA,MAAA,KAAA,EAAAF,EAAAC,KAAA,EAAAD,EAAAM,GAAAN,EAAA,MAAA,IAAA,EAAAjC,OAAAsC,cAAA,8BAAA,UAAA,KAAA,GAAA,IAAA,MAAA,OAAAL,EAAAO,SAAA,KAAAJ,KAAA,CAAA,CAAA,EAAA,WAAA,SAAAK,gBAAAvB,GAAA,OAAAa,mBAAAC,MAAA,SAAAU,GAAA,OAAA,OAAAA,EAAAR,KAAAQ,EAAAP,MAAA,KAAA,EAAA,GAO9BQ,QAAA,8CAP8B,OAAAD,EAAAR,KAAA,EAAAQ,EAAAP,KAAA,EAAAJ,mBAAAM,OAAA,EAAAtC,mBAAA6C,YAAA,EAAA7C,mBAAA8C,KAAA1C,gBAAAA,GAAA,WAAAe,KAAAwB,EAAAP,KAAA,GAAA,MAAA,KAAA,GAAA,EAAAnC,OAAAsC,cAAA,oCAAAI,EAAAP,KAAA,GAAA,MAAA,KAAA,EAAAO,EAAAR,KAAA,EAAAQ,EAAAH,GAAAG,EAAA,MAAA,IAAA,EAAA1C,OAAAsC,cAAA,mCAAA,KAAA,GAAA,IAAA,MAAA,OAAAI,EAAAF,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA","file":"usuarios.min.js","sourcesContent":["import { db } from \"./asset/js/firebaseConfig.js\";\r\nimport { collection, doc, updateDoc, deleteDoc, onSnapshot } from \"https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js\";\r\nimport { mostrarToast } from \"./asset/js/toast.js\";\r\n\r\nconst usuariosRef = collection(db, \"usuarios\");\r\n\r\nexport function cargarUsuarios() {\r\n  const tabla = document.getElementById(\"tablaUsuarios\");\r\n  tabla.innerHTML = \"\";\r\n\r\n  const filtroCorreo = document.getElementById(\"filtroUsuarioCorreo\").value.toLowerCase();\r\n  const filtroRol = document.getElementById(\"filtroRol\").value;\r\n\r\n  onSnapshot(usuariosRef, (snapshot) => {\r\n    tabla.innerHTML = \"\";\r\n    snapshot.forEach((docu) => {\r\n      const data = docu.data();\r\n      const uid = docu.id;\r\n      const email = data.email || \"\";\r\n      const rol = data.rol || \"user\";\r\n      if (!email.trim()) return;\r\n\r\n      const coincideCorreo = email.toLowerCase().includes(filtroCorreo);\r\n      const coincideRol = !filtroRol || rol === filtroRol;\r\n\r\n      if (coincideCorreo && coincideRol) {\r\n        const fila = document.createElement(\"tr\");\r\n        fila.innerHTML = `\r\n          <td>${email}</td>\r\n          <td>\r\n            <select class=\"form-select form-select-sm\" data-uid=\"${uid}\">\r\n              <option value=\"user\" ${rol === \"user\" ? \"selected\" : \"\"}>Usuario</option>\r\n              <option value=\"admin\" ${rol === \"admin\" ? \"selected\" : \"\"}>Administrador</option>\r\n            </select>\r\n          </td>\r\n          <td>\r\n            <button class=\"btn btn-sm btn-danger\" onclick=\"eliminarUsuario('${uid}')\">\r\n              <i class=\"fa fa-trash\"></i>\r\n            </button>\r\n          </td>\r\n        `;\r\n        tabla.appendChild(fila);\r\n      }\r\n    });\r\n\r\n    document.querySelectorAll('select[data-uid]').forEach(select => {\r\n      select.addEventListener(\"change\", async function () {\r\n        const nuevoRol = this.value;\r\n        const uid = this.dataset.uid;\r\n        try {\r\n          await updateDoc(doc(db, \"usuarios\", uid), { rol: nuevoRol });\r\n          mostrarToast(\"Rol actualizado correctamente.\", \"success\");\r\n        } catch (error) {\r\n          mostrarToast(\"Error al actualizar el rol.\", \"danger\");\r\n        }\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nexport async function eliminarUsuario(uid) {\r\n  if (confirm(\"Â¿Seguro que quieres eliminar este usuario?\")) {\r\n    try {\r\n      await deleteDoc(doc(db, \"usuarios\", uid));\r\n      mostrarToast(\"Usuario eliminado correctamente.\");\r\n    } catch (error) {\r\n      mostrarToast(\"No se pudo eliminar el usuario.\");\r\n    }\r\n  }\r\n}"]}