"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cargarVehiculos=cargarVehiculos,exports.abrirModalVehiculo=abrirModalVehiculo,exports.editarVehiculo=editarVehiculo,exports.guardarVehiculo=guardarVehiculo,exports.eliminarVehiculo=eliminarVehiculo;var _firebaseConfig=require("../firebaseConfig.js"),_firebaseFirestore=require("https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js"),_firebaseStorage=require("https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js"),_toast=require("../toast.js"),vehiculosRef=(0,_firebaseFirestore.collection)(_firebaseConfig.db,"vehiculos"),storage=(0,_firebaseStorage.getStorage)();function cargarVehiculos(){var d=document.getElementById("tablaVehiculos");d.innerHTML="",(0,_firebaseFirestore.onSnapshot)(vehiculosRef,function(e){d.innerHTML="";var i=document.getElementById("filtroMarca").value.toLowerCase(),s=document.getElementById("filtroDisponibilidad").value,c=document.getElementById("filtroAnio").value,l=parseFloat(document.getElementById("precioMin").value),u=parseFloat(document.getElementById("precioMax").value);e.forEach(function(e){var t=e.data(),a=!i||t.MARCA.toLowerCase().includes(i),o=""===s||t.DISPONIBLE.toString()===s,r=!c||t.AÑO.toString()===c,n=(!l||t.PRECIO_DIA>=l)&&(!u||t.PRECIO_DIA<=u);a&&o&&r&&n&&(d.innerHTML+="\n        <tr>\n          <td>".concat(t.MARCA,"</td>\n          <td>").concat(t.MODELO,"</td>\n          <td>").concat(t.PLACA,"</td>\n          <td>").concat(t.AÑO,"</td>\n          <td>L. ").concat(t.PRECIO_DIA.toFixed(2),'</td>\n          <td><span class="badge ').concat(t.DISPONIBLE?"bg-success":"bg-danger",'">').concat(t.DISPONIBLE?"Disponible":"No disponible",'</span></td>\n          <td id="proximaReserva-').concat(e.id,'">Cargando...</td>\n          <td>\n            <button class="btn btn-sm btn-secondary" onclick="editarVehiculo(\'').concat(e.id,'\')"><i class="fa fa-pen"></i></button>\n            <button class="btn btn-sm btn-danger" onclick="eliminarVehiculo(\'').concat(e.id,'\')"><i class="fa fa-trash"></i></button>\n          </td>\n        </tr>\n        '),mostrarProximaReserva(e.id))})})}function abrirModalVehiculo(){document.querySelectorAll("#modalVehiculo input, #modalVehiculo select").forEach(function(e){return e.value=""}),document.getElementById("disponible").value="true",document.getElementById("previewFotoVehiculo").style.display="none",new bootstrap.Modal(document.getElementById("modalVehiculo")).show()}function editarVehiculo(t){var a,o,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap((0,_firebaseFirestore.getDoc)((0,_firebaseFirestore.doc)(_firebaseConfig.db,"vehiculos",t)));case 2:(a=e.sent).exists()&&(o=a.data(),document.getElementById("vehiculoId").value=t,document.getElementById("marca").value=o.MARCA,document.getElementById("modelo").value=o.MODELO,document.getElementById("placa").value=o.PLACA,document.getElementById("anio").value=o.AÑO,document.getElementById("asientos").value=o.ASIENTOS,document.getElementById("combustible").value=o.COMBUSTIBLE,document.getElementById("transmision").value=o.TRANSMISION,document.getElementById("precioDia").value=o.PRECIO_DIA,document.getElementById("disponible").value=o.DISPONIBLE?"true":"false",r=document.getElementById("previewFotoVehiculo"),o.FOTO?(r.src=o.FOTO,r.style.display="block"):r.style.display="none",new bootstrap.Modal(document.getElementById("modalVehiculo")).show());case 4:case"end":return e.stop()}})}function guardarVehiculo(){var t,a,o,r,n,i,s,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=0,a=["marca","modelo","placa","anio","asientos","combustible","transmision","precioDia"];case 2:if(!(t<a.length)){e.next=10;break}if(o=a[t],document.getElementById(o).value.trim()){e.next=7;break}return e.abrupt("return",(0,_toast.mostrarToast)("Todos los campos del vehículo son obligatorios.","danger"));case 7:t++,e.next=2;break;case 10:if(r={MARCA:document.getElementById("marca").value.trim(),MODELO:document.getElementById("modelo").value.trim(),PLACA:document.getElementById("placa").value.trim(),"AÑO":parseInt(document.getElementById("anio").value),ASIENTOS:parseInt(document.getElementById("asientos").value),COMBUSTIBLE:document.getElementById("combustible").value.trim(),TRANSMISION:document.getElementById("transmision").value.trim(),PRECIO_DIA:parseFloat(document.getElementById("precioDia").value),DISPONIBLE:"true"===document.getElementById("disponible").value,updatedAt:new Date},n=document.getElementById("vehiculoId").value,i=document.getElementById("fotoVehiculo").files[0],e.prev=13,i)return s=(0,_firebaseStorage.ref)(storage,"vehiculos/".concat(Date.now(),"_").concat(i.name)),e.next=18,regeneratorRuntime.awrap((0,_firebaseStorage.uploadBytes)(s,i));e.next=22;break;case 18:return e.next=20,regeneratorRuntime.awrap((0,_firebaseStorage.getDownloadURL)(s));case 20:c=e.sent,r.FOTO=c;case 22:if(n)return e.next=25,regeneratorRuntime.awrap((0,_firebaseFirestore.updateDoc)((0,_firebaseFirestore.doc)(_firebaseConfig.db,"vehiculos",n),r));e.next=28;break;case 25:(0,_toast.mostrarToast)("Vehículo actualizado.","success"),e.next=32;break;case 28:return r.createdAt=new Date,e.next=31,regeneratorRuntime.awrap((0,_firebaseFirestore.addDoc)(vehiculosRef,r));case 31:(0,_toast.mostrarToast)("Vehículo agregado.","success");case 32:bootstrap.Modal.getInstance(document.getElementById("modalVehiculo")).hide(),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(13),(0,_toast.mostrarToast)("Error al guardar vehículo.","danger");case 38:case"end":return e.stop()}},null,null,[[13,35]])}function eliminarVehiculo(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("¿Seguro que deseas eliminar este vehículo?"))return e.prev=1,e.next=4,regeneratorRuntime.awrap((0,_firebaseFirestore.deleteDoc)((0,_firebaseFirestore.doc)(_firebaseConfig.db,"vehiculos",t)));e.next=10;break;case 4:(0,_toast.mostrarToast)("Vehículo eliminado correctamente."),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),(0,_toast.mostrarToast)("No se pudo eliminar.");case 10:case"end":return e.stop()}},null,null,[[1,7]])}window.abrirModalVehiculo=abrirModalVehiculo,document.getElementById("fotoVehiculo").addEventListener("change",function(){var e=this.files[0],t=document.getElementById("previewFotoVehiculo");if(e){var a=new FileReader;a.onload=function(e){t.src=e.target.result,t.style.display="block"},a.readAsDataURL(e)}else t.src="",t.style.display="none"});
//# sourceMappingURL=vehiculos.min.js.map
