{"version":3,"sources":["usuarios.js"],"names":["usuariosRef","db","cargarUsuarios","tabla","document","getElementById","innerHTML","filtroCorreo","value","toLowerCase","filtroRol","snapshot","forEach","docu","data","uid","id","email","rol","trim","coincideCorreo","includes","coincideRol","fila","createElement","appendChild","querySelectorAll","select","addEventListener","nuevoRol","dataset","eliminarUsuario","confirm"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,WAAW,GAAG,mCAAWC,kBAAX,EAAe,UAAf,CAApB;;AAEO,SAASC,cAAT,GAA0B;AAC/B,MAAMC,KAAK,GAAGC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAd;AACAF,EAAAA,KAAK,CAACG,SAAN,GAAkB,EAAlB;AAEA,MAAMC,YAAY,GAAGH,QAAQ,CAACC,cAAT,CAAwB,qBAAxB,EAA+CG,KAA/C,CAAqDC,WAArD,EAArB;AACA,MAAMC,SAAS,GAAGN,QAAQ,CAACC,cAAT,CAAwB,WAAxB,EAAqCG,KAAvD;AAEA,qCAAWR,WAAX,EAAwB,UAACW,QAAD,EAAc;AACpCR,IAAAA,KAAK,CAACG,SAAN,GAAkB,EAAlB;AACAK,IAAAA,QAAQ,CAACC,OAAT,CAAiB,UAACC,IAAD,EAAU;AACzB,UAAMC,IAAI,GAAGD,IAAI,CAACC,IAAL,EAAb;AACA,UAAMC,GAAG,GAAGF,IAAI,CAACG,EAAjB;AACA,UAAMC,KAAK,GAAGH,IAAI,CAACG,KAAL,IAAc,EAA5B;AACA,UAAMC,GAAG,GAAGJ,IAAI,CAACI,GAAL,IAAY,MAAxB;AACA,UAAI,CAACD,KAAK,CAACE,IAAN,EAAL,EAAmB;AAEnB,UAAMC,cAAc,GAAGH,KAAK,CAACR,WAAN,GAAoBY,QAApB,CAA6Bd,YAA7B,CAAvB;AACA,UAAMe,WAAW,GAAG,CAACZ,SAAD,IAAcQ,GAAG,KAAKR,SAA1C;;AAEA,UAAIU,cAAc,IAAIE,WAAtB,EAAmC;AACjC,YAAMC,IAAI,GAAGnB,QAAQ,CAACoB,aAAT,CAAuB,IAAvB,CAAb;AACAD,QAAAA,IAAI,CAACjB,SAAL,6BACQW,KADR,wGAG2DF,GAH3D,uDAI6BG,GAAG,KAAK,MAAR,GAAiB,UAAjB,GAA8B,EAJ3D,sEAK8BA,GAAG,KAAK,OAAR,GAAkB,UAAlB,GAA+B,EAL7D,6KASsEH,GATtE;AAcAZ,QAAAA,KAAK,CAACsB,WAAN,CAAkBF,IAAlB;AACD;AACF,KA5BD;AA8BAnB,IAAAA,QAAQ,CAACsB,gBAAT,CAA0B,kBAA1B,EAA8Cd,OAA9C,CAAsD,UAAAe,MAAM,EAAI;AAC9DA,MAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAC1BC,gBAAAA,QAD0B,GACf,KAAKrB,KADU;AAE1BO,gBAAAA,GAF0B,GAEpB,KAAKe,OAAL,CAAaf,GAFO;AAAA;AAAA;AAAA,gDAIxB,kCAAU,4BAAId,kBAAJ,EAAQ,UAAR,EAAoBc,GAApB,CAAV,EAAoC;AAAEG,kBAAAA,GAAG,EAAEW;AAAP,iBAApC,CAJwB;;AAAA;AAK9B,yCAAa,gCAAb,EAA+C,SAA/C;AAL8B;AAAA;;AAAA;AAAA;AAAA;AAO9B,yCAAa,6BAAb,EAA4C,QAA5C;;AAP8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAlC;AAUD,KAXD;AAYD,GA5CD;AA6CD;;AAEM,SAAeE,eAAf,CAA+BhB,GAA/B;AAAA;AAAA;AAAA;AAAA;AAAA,eACDiB,OAAO,CAAC,4CAAD,CADN;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,0CAGK,kCAAU,4BAAI/B,kBAAJ,EAAQ,UAAR,EAAoBc,GAApB,CAAV,CAHL;;AAAA;AAID,mCAAa,kCAAb;AAJC;AAAA;;AAAA;AAAA;AAAA;AAMD,mCAAa,iCAAb;;AANC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import { db } from \"../firebaseConfig.js\";\r\nimport { collection, onSnapshot, updateDoc, deleteDoc, doc } from \"https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js\";\r\nimport { mostrarToast } from \"../toast.js\";\r\n\r\nconst usuariosRef = collection(db, \"usuarios\");\r\n\r\nexport function cargarUsuarios() {\r\n  const tabla = document.getElementById(\"tablaUsuarios\");\r\n  tabla.innerHTML = \"\";\r\n\r\n  const filtroCorreo = document.getElementById(\"filtroUsuarioCorreo\").value.toLowerCase();\r\n  const filtroRol = document.getElementById(\"filtroRol\").value;\r\n\r\n  onSnapshot(usuariosRef, (snapshot) => {\r\n    tabla.innerHTML = \"\";\r\n    snapshot.forEach((docu) => {\r\n      const data = docu.data();\r\n      const uid = docu.id;\r\n      const email = data.email || \"\";\r\n      const rol = data.rol || \"user\";\r\n      if (!email.trim()) return;\r\n\r\n      const coincideCorreo = email.toLowerCase().includes(filtroCorreo);\r\n      const coincideRol = !filtroRol || rol === filtroRol;\r\n\r\n      if (coincideCorreo && coincideRol) {\r\n        const fila = document.createElement(\"tr\");\r\n        fila.innerHTML = `\r\n          <td>${email}</td>\r\n          <td>\r\n            <select class=\"form-select form-select-sm\" data-uid=\"${uid}\">\r\n              <option value=\"user\" ${rol === \"user\" ? \"selected\" : \"\"}>Usuario</option>\r\n              <option value=\"admin\" ${rol === \"admin\" ? \"selected\" : \"\"}>Administrador</option>\r\n            </select>\r\n          </td>\r\n          <td>\r\n            <button class=\"btn btn-sm btn-danger\" onclick=\"eliminarUsuario('${uid}')\">\r\n              <i class=\"fa fa-trash\"></i>\r\n            </button>\r\n          </td>\r\n        `;\r\n        tabla.appendChild(fila);\r\n      }\r\n    });\r\n\r\n    document.querySelectorAll('select[data-uid]').forEach(select => {\r\n      select.addEventListener(\"change\", async function () {\r\n        const nuevoRol = this.value;\r\n        const uid = this.dataset.uid;\r\n        try {\r\n          await updateDoc(doc(db, \"usuarios\", uid), { rol: nuevoRol });\r\n          mostrarToast(\"Rol actualizado correctamente.\", \"success\");\r\n        } catch (error) {\r\n          mostrarToast(\"Error al actualizar el rol.\", \"danger\");\r\n        }\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nexport async function eliminarUsuario(uid) {\r\n  if (confirm(\"Â¿Seguro que quieres eliminar este usuario?\")) {\r\n    try {\r\n      await deleteDoc(doc(db, \"usuarios\", uid));\r\n      mostrarToast(\"Usuario eliminado correctamente.\");\r\n    } catch (error) {\r\n      mostrarToast(\"No se pudo eliminar el usuario.\");\r\n    }\r\n  }\r\n}"],"file":"usuarios.dev.js"}