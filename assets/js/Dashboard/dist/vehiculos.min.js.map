{"version":3,"sources":["vehiculos.js"],"names":["_firebaseConfig","require","_firebaseFirestore","_firebaseStorage","_toast","vehiculosRef","collection","db","getStorage","cargarVehiculos","tabla","getElementById","document","onSnapshot","snapshot","innerHTML","dispoFiltro","value","toLowerCase","anioFiltro","precioMin","parseFloat","precioMax","docu","cumpleMarca","cumpleDispo","cumplePrecio","data","PRECIO_DIA","DISPONIBLE","toString","cumpleAnio","concat","MARCA","abrirModalVehiculo","querySelectorAll","AÑO","toFixed","id","mostrarProximaReserva","forEach","e","docSnap","style","display","bootstrap","Modal","show","preview","ASIENTOS","COMBUSTIBLE","TRANSMISION","FOTO","src","guardarVehiculo","_i","_campos","_id","vehiculo","archivoImagen","refImg","url","regeneratorRuntime","async","_context2","prev","next","length","trim","abrupt","mostrarToast","campos","PLACA","parseInt","updatedAt","Date","files","ref","storage","now","name","awrap","uploadBytes","getDownloadURL","sent","updateDoc","doc","MODELO","hide","t0","stop","eliminarVehiculo","_context3","confirm","addEventListener","file","reader","FileReader","onload","target","result","readAsDataURL"],"mappings":"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","file":"vehiculos.min.js","sourcesContent":["import { db } from \"../firebaseConfig.js\";\r\nimport {\r\n  collection,\r\n  onSnapshot,\r\n  updateDoc,\r\n  deleteDoc,\r\n  doc,\r\n  addDoc,\r\n  getDoc\r\n} from \"https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js\";\r\nimport {\r\n  getStorage,\r\n  ref as storageRef,\r\n  uploadBytes,\r\n  getDownloadURL\r\n} from \"https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js\";\r\nimport { mostrarToast } from \"../toast.js\";\r\n\r\nconst vehiculosRef = collection(db, \"vehiculos\");\r\nconst storage = getStorage();\r\n\r\nexport function cargarVehiculos() {\r\n  const tabla = document.getElementById(\"tablaVehiculos\");\r\n  tabla.innerHTML = \"\";\r\n\r\n  onSnapshot(vehiculosRef, (snapshot) => {\r\n    tabla.innerHTML = \"\";\r\n\r\n    const marcaFiltro = document.getElementById(\"filtroMarca\").value.toLowerCase();\r\n    const dispoFiltro = document.getElementById(\"filtroDisponibilidad\").value;\r\n    const anioFiltro = document.getElementById(\"filtroAnio\").value;\r\n    const precioMin = parseFloat(document.getElementById(\"precioMin\").value);\r\n    const precioMax = parseFloat(document.getElementById(\"precioMax\").value);\r\n\r\n    snapshot.forEach((docu) => {\r\n      const data = docu.data();\r\n\r\n      const cumpleMarca = !marcaFiltro || data.MARCA.toLowerCase().includes(marcaFiltro);\r\n      const cumpleDispo = dispoFiltro === \"\" || data.DISPONIBLE.toString() === dispoFiltro;\r\n      const cumpleAnio = !anioFiltro || data.AÑO.toString() === anioFiltro;\r\n      const cumplePrecio = (!precioMin || data.PRECIO_DIA >= precioMin) &&\r\n                           (!precioMax || data.PRECIO_DIA <= precioMax);\r\n\r\n      if (cumpleMarca && cumpleDispo && cumpleAnio && cumplePrecio) {\r\n        tabla.innerHTML += `\r\n        <tr>\r\n          <td>${data.MARCA}</td>\r\n          <td>${data.MODELO}</td>\r\n          <td>${data.PLACA}</td>\r\n          <td>${data.AÑO}</td>\r\n          <td>L. ${data.PRECIO_DIA.toFixed(2)}</td>\r\n          <td><span class=\"badge ${data.DISPONIBLE ? 'bg-success' : 'bg-danger'}\">${data.DISPONIBLE ? 'Disponible' : 'No disponible'}</span></td>\r\n          <td id=\"proximaReserva-${docu.id}\">Cargando...</td>\r\n          <td>\r\n            <button class=\"btn btn-sm btn-secondary\" onclick=\"editarVehiculo('${docu.id}')\"><i class=\"fa fa-pen\"></i></button>\r\n            <button class=\"btn btn-sm btn-danger\" onclick=\"eliminarVehiculo('${docu.id}')\"><i class=\"fa fa-trash\"></i></button>\r\n          </td>\r\n        </tr>\r\n        `;\r\n        mostrarProximaReserva(docu.id);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nexport function abrirModalVehiculo() {\r\n  document.querySelectorAll(\"#modalVehiculo input, #modalVehiculo select\").forEach(e => e.value = \"\");\r\n  document.getElementById(\"disponible\").value = \"true\";\r\n  document.getElementById(\"previewFotoVehiculo\").style.display = \"none\";\r\n  new bootstrap.Modal(document.getElementById(\"modalVehiculo\")).show();\r\n}\r\nwindow.abrirModalVehiculo = abrirModalVehiculo;\r\n\r\nexport async function editarVehiculo(id) {\r\n  const docSnap = await getDoc(doc(db, \"vehiculos\", id));\r\n  if (docSnap.exists()) {\r\n    const data = docSnap.data();\r\n    document.getElementById(\"vehiculoId\").value = id;\r\n    document.getElementById(\"marca\").value = data.MARCA;\r\n    document.getElementById(\"modelo\").value = data.MODELO;\r\n    document.getElementById(\"placa\").value = data.PLACA;\r\n    document.getElementById(\"anio\").value = data.AÑO;\r\n    document.getElementById(\"asientos\").value = data.ASIENTOS;\r\n    document.getElementById(\"combustible\").value = data.COMBUSTIBLE;\r\n    document.getElementById(\"transmision\").value = data.TRANSMISION;\r\n    document.getElementById(\"precioDia\").value = data.PRECIO_DIA;\r\n    document.getElementById(\"disponible\").value = data.DISPONIBLE ? \"true\" : \"false\";\r\n\r\n    const preview = document.getElementById(\"previewFotoVehiculo\");\r\n    if (data.FOTO) {\r\n      preview.src = data.FOTO;\r\n      preview.style.display = \"block\";\r\n    } else {\r\n      preview.style.display = \"none\";\r\n    }\r\n\r\n    new bootstrap.Modal(document.getElementById(\"modalVehiculo\")).show();\r\n  }\r\n}\r\n\r\nexport async function guardarVehiculo() {\r\n  const campos = [\"marca\", \"modelo\", \"placa\", \"anio\", \"asientos\", \"combustible\", \"transmision\", \"precioDia\"];\r\n  for (let id of campos) {\r\n    const valor = document.getElementById(id).value.trim();\r\n    if (!valor) return mostrarToast(\"Todos los campos del vehículo son obligatorios.\", \"danger\");\r\n  }\r\n\r\n  const vehiculo = {\r\n    MARCA: document.getElementById(\"marca\").value.trim(),\r\n    MODELO: document.getElementById(\"modelo\").value.trim(),\r\n    PLACA: document.getElementById(\"placa\").value.trim(),\r\n    AÑO: parseInt(document.getElementById(\"anio\").value),\r\n    ASIENTOS: parseInt(document.getElementById(\"asientos\").value),\r\n    COMBUSTIBLE: document.getElementById(\"combustible\").value.trim(),\r\n    TRANSMISION: document.getElementById(\"transmision\").value.trim(),\r\n    PRECIO_DIA: parseFloat(document.getElementById(\"precioDia\").value),\r\n    DISPONIBLE: document.getElementById(\"disponible\").value === \"true\",\r\n    updatedAt: new Date()\r\n  };\r\n\r\n  const id = document.getElementById(\"vehiculoId\").value;\r\n  const archivoImagen = document.getElementById(\"fotoVehiculo\").files[0];\r\n\r\n  try {\r\n    if (archivoImagen) {\r\n      const refImg = storageRef(storage, `vehiculos/${Date.now()}_${archivoImagen.name}`);\r\n      await uploadBytes(refImg, archivoImagen);\r\n      const url = await getDownloadURL(refImg);\r\n      vehiculo.FOTO = url;\r\n    }\r\n\r\n    if (id) {\r\n      await updateDoc(doc(db, \"vehiculos\", id), vehiculo);\r\n      mostrarToast(\"Vehículo actualizado.\", \"success\");\r\n    } else {\r\n      vehiculo.createdAt = new Date();\r\n      await addDoc(vehiculosRef, vehiculo);\r\n      mostrarToast(\"Vehículo agregado.\", \"success\");\r\n    }\r\n\r\n    bootstrap.Modal.getInstance(document.getElementById(\"modalVehiculo\")).hide();\r\n  } catch (error) {\r\n    mostrarToast(\"Error al guardar vehículo.\", \"danger\");\r\n  }\r\n}\r\n\r\ndocument.getElementById(\"fotoVehiculo\").addEventListener(\"change\", function () {\r\n  const file = this.files[0];\r\n  const preview = document.getElementById(\"previewFotoVehiculo\");\r\n\r\n  if (file) {\r\n    const reader = new FileReader();\r\n    reader.onload = function (e) {\r\n      preview.src = e.target.result;\r\n      preview.style.display = \"block\";\r\n    };\r\n    reader.readAsDataURL(file);\r\n  } else {\r\n    preview.src = \"\";\r\n    preview.style.display = \"none\";\r\n  }\r\n});\r\nexport async function eliminarVehiculo(id) {\r\n  if (confirm(\"¿Seguro que deseas eliminar este vehículo?\")) {\r\n    try {\r\n      await deleteDoc(doc(db, \"vehiculos\", id));\r\n      mostrarToast(\"Vehículo eliminado correctamente.\");\r\n    } catch (error) {\r\n      mostrarToast(\"No se pudo eliminar.\");\r\n    }\r\n  }\r\n}"]}